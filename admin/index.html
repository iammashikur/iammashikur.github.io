<!doctype html>
<html lang="en">

<head>


    <title>Firebase Admin</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/lumen/bootstrap.min.css"
        integrity="sha384-GzaBcW6yPIfhF+6VpKMjxbTx6tvR/yRd/yJub90CqoIn2Tz4rRXlSpTFYMKHCifX" crossorigin="anonymous">

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css"
        integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ" crossorigin="anonymous">



</head>

<body>


    <style>
        body {
            background-color: rgb(37, 37, 37);
        }

        #profile {
            width: 100px;
            height: 100px;
        }

        .icon-image {
            width: 100%;
            height: 100%;
        }

        .icons {
            padding: 12px;
            background-color: rgb(221, 221, 221);
            width: 50px;
            height: 50px;
            border-radius: 25px;
        }

        .skill-item {
            margin-bottom: 20px;
            background-color: rgb(156, 156, 156);
            padding: 5px;
            border-radius: 10px;
        }

        .text {
            color: #fff;
            margin-top: 12px;
            margin-left: 10px;
            font-size: 19px;
        }

        .heading {
            display: inline-flex;
            margin-bottom: 10px;
        }
    </style>


    <div id="login" style="display: none;">
        <div class="container">
            <div class="mb-4">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-4 mt-5">
                        <div class="form-group">
                            <label for=""></label>
                            <input class="form-control" type="text" placeholder="username" id="username">
                        </div>
                        <div class="form-group">
                            <label for=""></label>
                            <input class="form-control" type="password" placeholder="password" id="password">
                        </div>
                        <button id="login-button" type="button" class="btn btn-primary float-right">Login
                            <i class="fas fa-sign-in-alt    "></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="admin" style="display: none;">

        <button id="logout"> Log out</button>

        <div class="container">
            <div class="mb-4">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-6 mt-5">

                        <div class="card mb-4">

                            <div class="card-header">
                                Intro
                            </div>

                            <div class="card-body">

                                <img id="profile" src="">

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="file" name="" id="file" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Avatar</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="name" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Name</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="designation" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Designation</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="github" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Guithub</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="facebook" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Facbook</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="whatsapp" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Whatsapp</small>
                                </div>

                                <button id="intro" type="button" class="btn btn-primary"> Save </button>

                            </div>




                        </div>

                        <div class="card mb-4">
                            <div class="card-header">
                                About
                            </div>
                            <div class="card-body">
                                <img id="about-image" src="">
                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="file" name="" id="about-file" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">About Image</small>
                                </div>
                                <div class="form-group">
                                    <label for=""></label>
                                    <textarea type="text" name="" id="about-text" class="form-control" placeholder=""
                                        aria-describedby="helpId"></textarea>

                                    <small id="helpId" class="text-muted">About Text</small>
                                </div>
                                <button id="about" type="button" class="btn btn-primary"> Save </button>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-header">
                                Skills
                            </div>
                            <div class="card-body">


                                <div class="mt-4 mb-4">

                                    <div class="row" id="show-skills">

                                    </div>

                                </div>



                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="file" name="" id="skill-file" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Skill Image</small>
                                </div>
                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="skill-name" class="form-control" placeholder=""
                                        aria-describedby="helpId">

                                    <small id="helpId" class="text-muted">Skill Name</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="text" name="" id="skill-color" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Progressbar Color</small>
                                </div>

                                <div class="form-group">
                                    <label for=""></label>
                                    <input type="number" name="" id="skill-percent" class="form-control" placeholder=""
                                        aria-describedby="helpId">
                                    <small id="helpId" class="text-muted">Progressbar %</small>
                                </div>


                                <button id="skill" type="button" class="btn btn-primary"> Save </button>
                            </div>
                        </div>


                    </div>

                </div>
            </div>
        </div>
    </div>




    <!-- Modal -->
    <div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">sm</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <input type="hidden" id="skill-edit-key">
                    <div class="form-group">
                        <label for=""></label>
                        <input type="file" name="" id="skill-edit-file" class="form-control" placeholder=""
                            aria-describedby="helpId">
                        <small id="helpId" class="text-muted">Skill Image</small>
                    </div>
                    <div class="form-group">
                        <label for=""></label>
                        <input type="text" name="" id="skill-edit-name" class="form-control" placeholder=""
                            aria-describedby="helpId">

                        <small id="helpId" class="text-muted">Skill Name</small>
                    </div>

                    <div class="form-group">
                        <label for=""></label>
                        <input type="text" name="" id="skill-edit-color" class="form-control" placeholder=""
                            aria-describedby="helpId">
                        <small id="helpId" class="text-muted">Progressbar Color</small>
                    </div>

                    <div class="form-group">
                        <label for=""></label>
                        <input type="number" name="" id="skill-edit-percent" class="form-control" placeholder=""
                            aria-describedby="helpId">
                        <small id="helpId" class="text-muted">Progressbar %</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="skill-save" class="btn btn-primary" data-dismiss="modal">Save</button>
                </div>
            </div>
        </div>
    </div>








    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script>
        let firebaseConfig = {
            apiKey: "AIzaSyA861wrEeRvCceaLuAkVd15_ZJ1OYCy3y8",
            authDomain: "liveletter-cef5d.firebaseapp.com",
            databaseURL: "https://liveletter-cef5d-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "liveletter-cef5d",
            storageBucket: "liveletter-cef5d.appspot.com",
            messagingSenderId: "563436281887",
            appId: "1:563436281887:web:458eba3a44e94fe5ceb52a",
            measurementId: "G-X3ZS712G1D"
        };

        firebase.initializeApp(firebaseConfig);

        let database = firebase.database();
        let storage = firebase.storage();


        let profile = firebase.database().ref('profile/');
        profile.on('value', (snapshot) => {
            const profile = snapshot.val();

            $('#profile').attr('src', profile.avatar);
            $('#name').val(profile.name);
            $('#designation').val(profile.designation);
            $('#github').val(profile.github);
            $('#facebook').val(profile.facebook);
            $('#whatsapp').val(profile.whatsapp);

        });

        let skills = firebase.database().ref('skills/');
        skills.on('value', (snapshot) => {
            $('#show-skills').html('');
            snapshot.forEach(function (childSnapshot) {
                var childData = childSnapshot.val();

                $('#show-skills').append(`
                    <div class="col-6 mb-4">
                        <div class="skill-item">
                            <div class="heading">
                                <div class="icons">
                                    <img class="icon-image" src="${childData.skill_file}"
                                        class="fab fa-html5"></i>
                                </div>
                                <div class="text">
                                    ${childData.skill_name} 
                                </div>
                            </div>
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated ${childData.skill_color}"
                                    role="progressbar" aria-valuenow="${childData.skill_percent}" aria-valuemin="0"
                                    aria-valuemax="100" style="width: ${childData.skill_percent}%"><span>${childData.skill_percent}%</span></div>
                            </div>
                            <button class="btn btn-primary mt-4" onclick="editSkill(${childSnapshot.key})"> Edit </button>
                            <button class="btn btn-danger mt-4" onclick="deleteSkill(${childSnapshot.key})"> Delete </button>
                        </div>
                    </div>
                `);
            });
        });

        const editSkill = (key) => {

            $('#modelId').modal('show');

            let edit_Skill = firebase.database().ref('skills/' + key);
            edit_Skill.on('value', (snapshot) => {
                const edit_Skill = snapshot.val();

                $('#skill-edit-key').val(key);
                $('#skill-edit-name').val(edit_Skill.skill_name);
                $('#skill-edit-color').val(edit_Skill.skill_color);
                $('#skill-edit-percent').val(edit_Skill.skill_percent);
                $('#skill-edit-file').attr('src', edit_Skill.skill_file);

            });

        };

        const deleteSkill = (key) => {

            firebase.database().ref('skills/' + key).remove();

        };

        $("#skill-save").on("click", async () => {




            let rand = $('#skill-edit-key').val();
            let skill_edit_file = document.querySelector('#skill-edit-file').files[0];
            let skill_edit_name = $("#skill-edit-name").val();
            let skill_edit_color = $("#skill-edit-color").val();
            let skill_edit_percent = $("#skill-edit-percent").val();

            const ref = firebase.storage().ref().child('skills/' + rand);

            if ($("#skill-edit-file").val()) {
                await ref.put(skill_edit_file).then((snapshot) => {
                    snapshot.ref.getDownloadURL().then(url => {
                        database.ref('skills/' + rand).update({
                            skill_file: url,
                        });
                    })
                });
            }

            database.ref('skills/' + rand).update({
                skill_name: skill_edit_name,
                skill_percent: skill_edit_percent,
                skill_color: skill_edit_color,
            });



        });

        $("#intro").on("click", async () => {


            let file = document.querySelector('#file').files[0];
            let name = $("#name").val();
            let designation = $("#designation").val();
            let github = $("#github").val();
            let facebook = $("#facebook").val();
            let whatsapp = $("#whatsapp").val();


            const ref = firebase.storage().ref().child('avatar');

            if ($("#file").val()) { // returns true if the string is not empty
                await ref.put(file).then((snapshot) => {
                    snapshot.ref.getDownloadURL().then(url => {
                        let avatar = console.log(' * new url', url)
                    })
                });
            }



            await database.ref('profile/').set({
                avatar: 'https://firebasestorage.googleapis.com/v0/b/liveletter-cef5d.appspot.com/o/avatar?alt=media',
                name,
                designation,
                github,
                facebook,
                whatsapp,
            });




        });


        $("#skill").on("click", async () => {


            let rand = Date.now();
            let skill_file = document.querySelector('#skill-file').files[0];
            let skill_name = $("#skill-name").val();
            let skill_color = $("#skill-color").val();
            let skill_percent = $("#skill-percent").val();

            const ref = firebase.storage().ref().child('skills/' + rand);

            if ($("#skill-file").val()) { // returns true if the string is not empty
                await ref.put(skill_file).then((snapshot) => {
                    snapshot.ref.getDownloadURL().then(url => {
                        let avatar = console.log(' * new url', url)
                    })
                });
            }

            await database.ref('skills/' + rand).set({
                skill_file: 'https://firebasestorage.googleapis.com/v0/b/liveletter-cef5d.appspot.com/o/skills%2F' + rand + '?alt=media',
                skill_name,
                skill_percent,
                skill_color,
            });




        })








        $(function () {

            let session_username = sessionStorage.getItem("username");
            let session_password = sessionStorage.getItem("password");

            let login = firebase.database().ref('login/');
            login.on('value', (snapshot) => {
                const data = snapshot.val();

                if (session_username == data.username && session_password == data.password) {
                    console.log('logged in succcessfull!');
                    $("#admin").show();
                } else {
                    $("#login").show();
                }

            });




        });

        $("#login-button").on("click", () => {

            let username = $("#username").val();
            let password = $("#password").val();

            // database.ref('login/').set({
            //     username: username,
            //     password: password,
            // });

            // alert("user added");

            let login = firebase.database().ref('login/');
            login.on('value', (snapshot) => {
                const data = snapshot.val();



                if (username == data.username && password == data.password) {
                    console.log('logged in succcessfull!');

                    sessionStorage.setItem("username", data.username);
                    sessionStorage.setItem("password", data.password);

                    $("#login").hide();
                    $("#admin").show();

                }
                else {
                    console.log('Wrong Credencials!');
                }
            });



        });

        $("#logout").on("click", () => {

            sessionStorage.setItem("username", null);
            sessionStorage.setItem("password", null);

            $("#login").show();
            $("#admin").hide();



        });







    </script>



</body>

</html>